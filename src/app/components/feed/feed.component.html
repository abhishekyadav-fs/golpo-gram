<div class="feed-container">
  <!-- Platform Description -->
  <div class="platform-description">
    <div class="description-content">
      <h2 class="description-title">Share Your Local Stories</h2>
      <p class="description-text">
        Discover and share <strong>bit-sized, interesting geo tagged stories</strong>. 
        Express yourself in your preferred format â€” <strong>text</strong>, <strong>audio recordings</strong>, 
        or <strong>video clips</strong>. Connect with your community through authentic, engaging narratives 
        that capture the essence of your neighborhood.
      </p>
      <div class="description-features">
        <button class="feature-badge" (click)="filterByType('text')" [class.active]="selectedType === 'text'">          
          Text Stories
        </button>
        <button class="feature-badge" (click)="filterByType('audio')" [class.active]="selectedType === 'audio'">          
          Audio Stories
        </button>
        <button class="feature-badge" (click)="filterByType('video')" [class.active]="selectedType === 'video'">          
          Video Stories
        </button>
        <button class="feature-badge" (click)="filterByType('all')" [class.active]="selectedType === 'all'">          
          All Content
        </button>
      </div>
    </div>
  </div>

  <!-- Locality Filter -->
  <div class="filter-section">
    <div class="filter-left">
      <label for="locality-filter">Filter by Locality:</label>
      <select
        id="locality-filter"
        [(ngModel)]="selectedLocalityId"
        (change)="onLocalityChange()"
        class="locality-select"
      >
        <option *ngFor="let locality of localities" [value]="locality.id">
          {{ locality.name }}
        </option>
      </select>
    </div>
    
    <div class="view-toggle">
      <button 
        class="view-btn" 
        [class.active]="viewMode === 'grid'" 
        (click)="viewMode = 'grid'"
        title="Grid View"
      >
        <span class="material-symbols-outlined">grid_view</span>
      </button>
      <button 
        class="view-btn" 
        [class.active]="viewMode === 'list'" 
        (click)="viewMode = 'list'"
        title="List View"
      >
        <span class="material-symbols-outlined">view_list</span>
      </button>
    </div>
  </div>

  <!-- Stories Feed -->
  <div class="stories-container">
    <div *ngIf="isLoading" class="loading-spinner">
      <div class="spinner"></div>
      <p>Loading stories...</p>
    </div>

    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <div *ngIf="noStoriesMessage && !errorMessage" class="info-message">
      {{ noStoriesMessage }}
    </div>

    <div *ngIf="!isLoading && stories.length === 0 && !errorMessage && !noStoriesMessage" class="empty-state">
      <p class="empty-icon">ðŸ“°</p>
      <h3>No stories yet</h3>
      <p>Be the first to share a story from this locality!</p>
      <button class="btn-primary" (click)="navigateToCreate()">
        Create Story
      </button>
    </div>

    <div class="story-grid" [class.list-view]="viewMode === 'list'">
      <article class="story-card" *ngFor="let story of stories" (click)="story.id && viewStory(story.id)">
        <div class="story-header">
          <div>
            <h2 class="story-title">{{ story.title }}</h2>
            <div class="story-meta">
              <span class="author">By {{ story.author_name }}</span>
              <span class="separator">â€¢</span>
              <span class="date">{{ formatDate(story.created_at) }}</span>
            </div>
          </div>
          <span class="locality-badge">
            <span class="material-symbols-outlined">location_on</span>
            {{ story.locality_name }}
          </span>
        </div>

        <div class="story-content" [class.truncated]="story.id && !expandedStories.has(story.id) && story.content.length > 200">
          <p>{{ story.id ? getPreviewContent(story.content, story.id) : story.content }}</p>
          <button 
            *ngIf="story.id && story.content.length > 200" 
            class="read-more-btn" 
            (click)="toggleExpand($event, story.id)"
          >
            {{ expandedStories.has(story.id) ? 'Show less' : 'Read more' }}
          </button>
        </div>
      </article>
    </div>

    <div *ngIf="isLoadingMore" class="loading-more">
      <div class="spinner-small"></div>
      <p>Loading more stories...</p>
    </div>
  </div>

  <!-- Floating Action Button (Mobile) -->
  <button *ngIf="authService.isAuthenticated()" class="fab" (click)="navigateToCreate()" title="Create Story">
    add
  </button>
</div>
