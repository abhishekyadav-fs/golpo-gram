<div class="feed-container">
  <!-- Platform Description -->
  <div class="platform-description">
    <div class="description-content">
      <h2 class="description-title">Share Your Local Stories</h2>
      <p class="description-text">
        Discover and share <strong>bit-sized, interesting geo tagged stories</strong>. 
        Express yourself in your preferred format â€” <strong>text</strong> or <strong>audio story</strong>. Connect with your community through authentic, engaging narratives 
        that capture the essence of your neighborhood.
      </p>
      <div class="description-features">
        <button class="feature-badge" (click)="filterByType('text')" [class.active]="selectedType === 'text'">          
          Text Stories
        </button>
        <button class="feature-badge" (click)="filterByType('audio')" [class.active]="selectedType === 'audio'">          
          Audio Stories
        </button>
        <button class="feature-badge" (click)="filterByType('all')" [class.active]="selectedType === 'all'">          
          All Content
        </button>
      </div>
    </div>
  </div>

  <!-- Locality Filter -->
  <div class="filter-section">
    <div class="filter-left">
      <label for="locality-search">Filter by Locality:</label>
      <div class="locality-search-container">
        <span class="material-symbols-outlined search-icon">location_on</span>
        <input
          id="locality-search"
          type="text"
          [(ngModel)]="localitySearch"
          (input)="onLocalitySearchInput()"
          (focus)="onLocalityInputFocus()"
          (blur)="onLocalityInputBlur()"
          class="locality-search-input"
          placeholder="Type to search localities..."
          autocomplete="off"
        />
        <div class="locality-dropdown" *ngIf="showLocalityDropdown && filteredLocalities.length > 0">
          <button
            *ngFor="let locality of filteredLocalities"
            class="locality-option"
            (click)="selectLocality(locality)"
            type="button"
          >
            <span class="material-symbols-outlined">location_on</span>
            <span>{{ locality.name }}</span>
          </button>
        </div>
      </div>
    </div>

    <div class="filter-right">
      <div class="search-box">
        <span class="material-symbols-outlined search-icon">search</span>
        <input 
          type="text" 
          placeholder="Search by storyteller..."
          [(ngModel)]="storytellerSearch"
          (input)="onStorytellerSearch()"
          class="search-input"
        />
        <button 
          *ngIf="storytellerSearch" 
          class="clear-search"
          (click)="clearSearch()"
          title="Clear search"
        >
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
    </div>
    
    <div class="view-toggle">
      <button 
        class="view-btn" 
        [class.active]="viewMode === 'grid'" 
        (click)="viewMode = 'grid'"
        title="Grid View"
      >
        <span class="material-symbols-outlined">grid_view</span>
      </button>
      <button 
        class="view-btn" 
        [class.active]="viewMode === 'list'" 
        (click)="viewMode = 'list'"
        title="List View"
      >
        <span class="material-symbols-outlined">view_list</span>
      </button>
    </div>
  </div>

  <!-- Stories Feed -->
  <div class="stories-container">
    <div *ngIf="isLoading" class="loading-spinner">
      <div class="spinner"></div>
      <p>Loading stories...</p>
    </div>

    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <div *ngIf="noStoriesMessage && !errorMessage" class="info-message">
      {{ noStoriesMessage }}
    </div>

    <div *ngIf="!isLoading && stories.length === 0 && !errorMessage && !noStoriesMessage" class="empty-state">
      <p class="empty-icon">ðŸ“°</p>
      <h3>No stories yet</h3>
      <p>Be the first to share a story from this locality!</p>
      <button class="btn-primary" (click)="navigateToCreate()">
        Create Story
      </button>
    </div>

    <div class="story-grid" [class.list-view]="viewMode === 'list'">
      <article class="story-card" *ngFor="let story of stories" (click)="story.id && viewStory(story.id)">
        <div class="story-header">
          <div>
            <h2 class="story-title">{{ story.title }}</h2>
            <div class="story-meta">
              <a 
                class="author-link" 
                [routerLink]="['/storyteller', story.author_id]"
                (click)="$event.stopPropagation()"
                *ngIf="story.author_id"
              >
                {{ story.author_name }}
              </a>
              <span class="author" *ngIf="!story.author_id">{{ story.author_name }}</span>
              <span class="separator">â€¢</span>
              <span class="date">{{ formatDate(story.created_at) }}</span>
            </div>
          </div>
          <span class="locality-badge">
            <span class="material-symbols-outlined">location_on</span>
            {{ story.locality_name }}
          </span>
        </div>

        <div class="story-content" [class.truncated]="story.id && story.content && !expandedStories.has(story.id) && story.content.length > 200">
          <p *ngIf="story.content">{{ story.id ? getPreviewContent(story.content, story.id) : story.content }}</p>
          <p *ngIf="!story.content && story.story_type === 'audio'" class="audio-indicator">
            <span class="material-symbols-outlined">audio_file</span>
            Audio Story
          </p>
          <button 
            *ngIf="story.id && story.content && story.content.length > 200" 
            class="read-more-btn" 
            (click)="toggleExpand($event, story.id)"
          >
            {{ expandedStories.has(story.id) ? 'Show less' : 'Read more' }}
          </button>
        </div>
      </article>
    </div>

    <div *ngIf="isLoadingMore" class="loading-more">
      <div class="spinner-small"></div>
      <p>Loading more stories...</p>
    </div>
  </div>

  <!-- Scroll to Top Button (Mobile) -->
  <button class="fab" (click)="scrollToTop()" title="Scroll to Top">
    <span class="material-symbols-outlined">arrow_upward</span>
  </button>
</div>
