<div class="create-story-container">
  <div class="create-story-card">
    <h2 class="page-title">Share Your Story</h2>

    <form [formGroup]="storyForm" (ngSubmit)="onSubmit()" class="story-form">
      <div class="form-group">
        <label for="title">Story Title *</label>
        <input
          id="title"
          type="text"
          formControlName="title"
          class="form-control"
          placeholder="Enter an engaging title"
        />
        <div class="error-message" *ngIf="storyForm.get('title')?.invalid && storyForm.get('title')?.touched">
          <span *ngIf="storyForm.get('title')?.errors?.['required']">Title is required</span>
          <span *ngIf="storyForm.get('title')?.errors?.['minlength']">Title must be at least 5 characters</span>
        </div>
      </div>

      <div class="form-group">
        <label for="locality_id">Locality *</label>
        <select
          id="locality_id"
          formControlName="locality_id"
          class="form-control"
        >
          <option value="">Select a locality</option>
          <option *ngFor="let locality of localities" [value]="locality.id">
            {{ locality.name }}
          </option>
        </select>
        <div class="error-message" *ngIf="storyForm.get('locality_id')?.invalid && storyForm.get('locality_id')?.touched">
          Locality is required
        </div>
      </div>

      <div class="form-group">
        <label for="content">Story Content *</label>
        <textarea
          id="content"
          formControlName="content"
          class="form-control textarea-control"
          rows="8"
          placeholder="Tell your story..."
        ></textarea>
        <div class="error-message" *ngIf="storyForm.get('content')?.invalid && storyForm.get('content')?.touched">
          <span *ngIf="storyForm.get('content')?.errors?.['required']">Content is required</span>
          <span *ngIf="storyForm.get('content')?.errors?.['minlength']">Content must be at least 20 characters</span>
        </div>
      </div>

      <div class="form-group">
        <label>Add Media (Images, Audio, Video)</label>
        <div class="file-upload-area">
          <input
            type="file"
            id="fileInput"
            (change)="onFileSelect($event)"
            accept="image/*,video/*,audio/*"
            multiple
            hidden
          />
          <label for="fileInput" class="file-upload-label">
            <span class="upload-icon">ðŸ“Ž</span>
            Choose Files
          </label>
        </div>

        <div class="file-previews" *ngIf="filePreviews.length > 0">
          <div class="file-preview" *ngFor="let preview of filePreviews; let i = index">
            <img *ngIf="preview.type === 'image'" [src]="preview.url" alt="Preview" />
            <video *ngIf="preview.type === 'video'" [src]="preview.url" controls></video>
            <audio *ngIf="preview.type === 'audio'" [src]="preview.url" controls></audio>
            <div class="file-info">
              <span class="file-name">{{ preview.name }}</span>
              <button type="button" class="btn-remove" (click)="removeFile(i)">âœ•</button>
            </div>
          </div>
        </div>
      </div>

      <div class="error-message" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <div class="success-message" *ngIf="successMessage">
        {{ successMessage }}
      </div>

      <div class="form-actions">
        <button type="button" class="btn-secondary" routerLink="/feed">
          Cancel
        </button>
        <button
          type="submit"
          class="btn-primary"
          [disabled]="storyForm.invalid || isLoading"
        >
          {{ isLoading ? 'Submitting...' : 'Submit Story' }}
        </button>
      </div>
    </form>
  </div>
</div>
