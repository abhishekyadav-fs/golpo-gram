<div class="moderation-container">
  <div class="mod-actions">
    <h1 class="mod-title">Story Moderation</h1>
    <button class="btn-icon" routerLink="/feed" title="Home">home</button>
  </div>

  <div class="mod-content">
    <div class="pending-list">
      <h2 class="section-title">Pending Stories ({{ pendingStories.length }})</h2>

      <div *ngIf="isLoading && pendingStories.length === 0" class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading pending stories...</p>
      </div>

      <div *ngIf="!isLoading && pendingStories.length === 0" class="empty-state">
        <p class="empty-icon">âœ…</p>
        <h3>No pending stories</h3>
        <p>All caught up! Great job.</p>
      </div>

      <div class="story-list">
        <div
          *ngFor="let story of pendingStories"
          class="story-item"
          [class.selected]="selectedStory?.id === story.id"
          (click)="selectStory(story)"
        >
          <h3 class="story-item-title">{{ story.title }}</h3>
          <div class="story-item-meta">
            <span><span class="material-symbols-outlined">location_on</span> {{ story.locality_name }}</span>
            <span><span class="material-symbols-outlined">person</span> {{ story.author_name }}</span>
            <span><span class="material-symbols-outlined">calendar_today</span> {{ formatDate(story.created_at) }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="story-detail" *ngIf="selectedStory">
      <div class="detail-header">
        <h2>{{ selectedStory.title }}</h2>
        <button class="btn-close" (click)="closeDetail()">âœ•</button>
      </div>

      <div class="detail-meta">
        <span class="meta-item"><span class="material-symbols-outlined">location_on</span> {{ selectedStory.locality_name }}</span>
        <span class="meta-item"><span class="material-symbols-outlined">person</span> {{ selectedStory.author_name }}</span>
        <span class="meta-item"><span class="material-symbols-outlined">calendar_today</span> {{ formatDate(selectedStory.created_at) }}</span>
      </div>

      <div class="detail-content">
        <h3>Content</h3>
        <p>{{ selectedStory.content }}</p>
      </div>

      <div class="detail-media" *ngIf="selectedStory.media_files && selectedStory.media_files.length > 0">
        <h3>Media Files ({{ selectedStory.media_files.length }})</h3>
        <div class="media-grid">
          <div *ngFor="let media of selectedStory.media_files" class="media-item">
            <img *ngIf="media.file_type === 'image'" [src]="media.file_url" [alt]="media.file_name" />
            <video *ngIf="media.file_type === 'video'" [src]="media.file_url" controls></video>
            <audio *ngIf="media.file_type === 'audio'" [src]="media.file_url" controls></audio>
          </div>
        </div>
      </div>

      <div class="moderation-form">
        <h3>Moderation Notes</h3>
        <textarea
          [(ngModel)]="moderationNotes"
          class="notes-textarea"
          placeholder="Add notes about your decision (optional)"
          rows="3"
        ></textarea>

        <div *ngIf="errorMessage" class="error-message">
          {{ errorMessage }}
        </div>

        <div *ngIf="successMessage" class="success-message">
          {{ successMessage }}
        </div>

        <div class="moderation-actions">
          <button
            class="btn-reject"
            (click)="moderateStory('rejected')"
            [disabled]="isLoading"
          >
            {{ isLoading ? 'Processing...' : 'Reject' }}
          </button>
          <button
            class="btn-approve"
            (click)="moderateStory('approved')"
            [disabled]="isLoading"
          >
            {{ isLoading ? 'Processing...' : 'Approve' }}
          </button>
        </div>
      </div>
    </div>

    <div class="story-detail-placeholder" *ngIf="!selectedStory && pendingStories.length > 0">
      <p class="placeholder-icon">ðŸ‘ˆ</p>
      <h3>Select a story to review</h3>
      <p>Choose a pending story from the list to review its content and moderate.</p>
    </div>
  </div>
</div>
